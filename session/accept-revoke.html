<!DOCTYPE html>
<html lang="it">
<head><meta charset="UTF-8"><title>Accetta Revoca</title></head>
<body style="font-family: Arial; padding:20px;">
  <h2>✅ Accettazione Revoca</h2>
  <div id="result">⏳ Invio conferma...</div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, doc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyATGSpPkvYLxazHHWW90oWWkgxoEsTkayI",
      authDomain: "trueconsent-cab73.firebaseapp.com",
      projectId: "trueconsent-cab73",
      storageBucket: "trueconsent-cab73.firebasestorage.app",
      messagingSenderId: "298691251398",
      appId: "1:298691251398:web:793a5aea900cc1cccc1bc7"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const url = new URL(window.location.href);
    const userId = url.searchParams.get("userId");
    const sessionId = url.searchParams.get("sessionId");

    async function acceptRevoke() {
      try {
        const ref = doc(db, "users", userId, "sessions", sessionId);
        await updateDoc(ref, {
          status: "revoked",
          revokedAt: serverTimestamp(),
          revokeCounterpartyAt: serverTimestamp()
        });
        document.getElementById("result").innerHTML = "✅ Revoca accettata, consenso terminato.";
      } catch {
        document.getElementById("result").innerHTML = "❌ Errore durante l'accettazione.";
      }
    }
    acceptRevoke();
  </script>
</body>
</html>
